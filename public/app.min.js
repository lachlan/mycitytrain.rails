function plural(a){return a+"s"}function pluralize(b,a){var c=(b==1||b=="1")?a:plural(a);if(b){c=b+" "+c}else{c="0 "+c}return c}function durationInSeconds(b,a){return Math.round((a-b)/1000)}function durationInWords(c){var e=c;var a;var d=e;if(e<0){d=e*-1}if(d==0){a="now"}else{if(d>=1&&d<=3599){a=pluralize(Math.ceil(e/60),"min")}else{if(d>=3600&&d<=86399){var b=Math.floor(e/3600);var h=(e%3600)/60;if(h<30){a=pluralize(b,"hour")}else{a=pluralize(b+0.5,"hour")}}else{if(d>=86400&&d<=2591999){var g=Math.floor(e/86400);var f=(e%86400)/3600;if(f<12){a=pluralize(g,"day")}else{a=pluralize(g+0.5,"day")}}else{if(d<=2592000&&d<=31535999){a=pluralize(Math.ceil(e/2592000),"mth")}else{a=pluralize(Math.ceil(e/31536000),"yr")}}}}}return a}var millisecondsUntilNextMinute=function(){var a=new Date();var b=new Date();b.setMinutes(a.getMinutes()+1);b.setSeconds(0);b.setMilliseconds(0);return b-a};var generateID=function(a){return"id"+a.replace(/[^a-zA-Z0-9]/g,"_")};$(document).ready(function(){$.support.WebKitAnimationEvent=(typeof WebKitTransitionEvent=="object");var l=5;var g="active";var d="fx in out flip slide pop cube swap slideup dissolve fade reverse";var h=new Array();var m=function(o,p){if(p){var r=new RegExp("^"+o+"$","i")}else{var r=new RegExp("^"+o,"i")}var q=new Array();for(var n=0;n<h.length;n++){if(h[n].match(r)){q.push(h[n])}}return q};$("input.origin, input.destination").autocomplete({minLength:1,source:function(o,n){j(function(){n(m(o.term))})}});var j=function(n){if(h.length==0){$.getJSON("/stations",function(o){h=o;if(n){n()}})}else{if(n){n()}}};var f=function(){$("a.loader").click(function(){k($(this).parents(".journeys"));return false});$("a.fx:not(.disabled):not(.submit)").click(function(){$(this).trigger("transition");return false});$("a.disabled").click(function(){return false});$("a.fx").bind("transition",function(){var r=$(this);var p=r.attr("class");var s=r.parents(".page").last();var o=r.attr("href");var q=function(v){$(":focus").blur();$(s).add(v).removeClass(d).addClass(p);v.addClass("in").addClass(g);s.addClass("out");var u=function(){s.removeClass(g).add(v).removeClass(d);v.find("a.back").attr("href","#"+s.attr("id")).addClass("reverse").addClass(p);c(e)};if($.support.WebKitAnimationEvent){v.one("webkitAnimationEnd",function(){u()})}else{u()}};if((o).match("^#")){q($(o))}else{var t=generateID(o);$("body").find("#"+t).remove();$("body").append('<div id="'+t+'" class="page"></div>');r.addClass("disabled");$.get(o,function(u){q($("#"+t).append(u));r.attr("href","#"+t).removeClass("disabled");f()})}return false});var n=function(){var p=$(this).attr("value");if(p){var o=m(p,true);if(o.length>0){$(this).attr("value",o[0])}}};$("#settings form input").change(function(){n();$(this).parents("form").data("dirty",true)});$(".submit").click(function(){var p=$(this);var o=$("#settings form");if(o.data("dirty")){j(function(){p.addClass("disabled");$("#settings form input[type=text]").each(n);$.post(o.attr("action"),o.serialize(),function(q){o.data("dirty",false);b(function(){f();if($("#favourites").length>0){p.trigger("transition").removeClass("disabled")}})})})}else{p.trigger("transition").removeClass("disabled")}return false})};var c=function(q,n){var p=$(".page."+g);var o=$(".page").first();if(p.length>0){o=p.removeClass(g).first()}if(n){o.fadeIn("slow",function(){$(this).addClass(g)})}else{o.addClass(g)}if(q){q()}};var b=function(n){$.get("/",function(o){$("#favourites").replaceWith(o);if(n){n()}})};var k=function(p,n){var q=p.find(".journey").last();var o=p.find("a.loader").attr("href");if(o){o=o.replace(/^(.*)=(.*)$/,"$1="+q.attr("title"));if(n&&n>0){o=o+"&limit="+n}$.get(o,function(r){var s=generateID(o);$("#"+s).remove();$("body").append('<div id="'+s+'"></div>');$("#"+s).append(r);q.after($("#"+s).find(".journey").hide().slideDown("slow",function(){$("#"+s).remove();var t=p.find("a.loader");t.attr("href",t.attr("href").replace(/^(.*)=(.*)$/,"$1="+p.find(".journey").last().attr("title")))}));f()})}};$(document).keydown(function(n){if(n.keyCode=="37"){$(".active .left.arrow a").click()}else{if(n.keyCode=="39"){$(".active .right.arrow a").click()}else{if(n.keyCode=="38"){$(".active a.return.reverse").click()}else{if(n.keyCode=="40"){$(".active a.return:not(.reverse)").click()}}}}});var e=function(){$(".page").css("min-height",$(window).height())};$(window).resize(e);var i=function(){$(".journey .eta").each(function(){var r=$(this);var q=r.parents(".journey");var t=new Date();var p=new Date();t.setTime(r.parent().find(".time").first().attr("data-time"));var s=durationInSeconds(p,t);var o=s/60;if(o<=5){r.removeClass("lt_ten").addClass("lt_five")}else{if(o<=10){r.addClass("lt_ten")}}if(s>0||q.hasClass("detail")){r.html(durationInWords(s))}else{r.html("now");q.addClass("expired")}});var n=function(o){if(o){o.animate({opacity:0.5},1000,"linear",function(){$(this).animate({opacity:1},1000,"linear",function(){$(this).animate({opacity:0.5},1000,"linear",function(){$(this).animate({opacity:1},1000,"linear",function(){$(this).animate({opacity:0.5},1000,"linear",function(){$(this).animate({opacity:1},1000,"linear",function(){$(this).slideUp("slow",function(){var p=$(this).parents(".journeys");$(this).remove()})})})})})})})}};$(".journeys").each(function(){var o=$(this);var p=o.find(".journey.expired");var q=l-(o.find(".journey").length-p.length);if(q>0){k(o,q)}n(p)});window.setTimeout(i,millisecondsUntilNextMinute())};var a=$(".ie6 .browser-warning, .ie7 .browser-warning, .ie8 .browser-warning");a.first().slideDown("slow",function(){window.setTimeout(function(){a.first().slideUp("slow",function(){$(".browser-warning").remove()})},10000)});c(e);i();f()});