function plural(a){return a+"s"}function pluralize(b,a){var c=(b==1||b=="1")?a:plural(a);if(b){c=b+" "+c}else{c="0 "+c}return c}function durationInSeconds(b,a){return Math.round((a-b)/1000)}function durationInWords(c){var e=c;var a;var d=e;if(e<0){d=e*-1}if(d==0){a="now"}else{if(d>=1&&d<=3599){a=pluralize(Math.ceil(e/60),"min")}else{if(d>=3600&&d<=86399){var b=Math.floor(e/3600);var h=(e%3600)/60;if(h<30){a=pluralize(b,"hour")}else{a=pluralize(b+0.5,"hour")}}else{if(d>=86400&&d<=2591999){var g=Math.floor(e/86400);var f=(e%86400)/3600;if(f<12){a=pluralize(g,"day")}else{a=pluralize(g+0.5,"day")}}else{if(d<=2592000&&d<=31535999){a=pluralize(Math.ceil(e/2592000),"mth")}else{a=pluralize(Math.ceil(e/31536000),"yr")}}}}}return a}var millisecondsUntilNextMinute=function(){var a=new Date();var b=new Date();b.setMinutes(a.getMinutes()+1);b.setSeconds(0);b.setMilliseconds(0);return b-a};var generateID=function(a){return"id"+a.replace(/[^a-zA-Z0-9]/g,"_")};var stations=new Array();var search=function(b,c){if(c){var e=new RegExp("^"+b+"$","i")}else{var e=new RegExp("^"+b,"i")}var d=new Array();for(var a=0;a<stations.length;a++){if(stations[a].match(e)){d.push(stations[a])}}return d};var loadStations=function(a){if(stations.length==0){$.getJSON("/stations",function(b){stations=b;if(a){a()}})}else{if(a){a()}}};var updateStationName=function(a){var c=$(a).attr("value");if(c){var b=search(c,true);if(b.length>0){$(a).attr("value",b[0])}}};var saveFormValues=function(a){$(a).find("input").each(function(){$(this).data("value",$(this).attr("value"))})};var formHasChanged=function(b){var a=false;$(b).find("input").each(function(){a=a||($(this).attr("value")!==$(this).data("value"))});return a};$(document).ready(function(){$.support.WebKitAnimationEvent=(typeof WebKitTransitionEvent=="object");var h=5;var f="active";var d="fx in out flip slide pop cube swap slideup dissolve fade reverse";$("input.origin, input.destination").autocomplete({minLength:1,source:function(k,j){loadStations(function(){j(search(k.term))})}});$("body").delegate("a.loader:not(.disabled)","click",function(){var j=$(this);j.addClass("disabled");i($(this).parents(".journeys"),null,function(){j.removeClass("disabled")});return false});$("body").delegate("a.fx:not(.disabled):not(.submit)","click",function(){$(this).trigger("transition");return false});$("body").delegate("a.disabled","click",function(){return false});$("body").delegate("a.fx","transition",function(){var m=$(this);var k=m.attr("class");var n=m.parents(".page").last();var j=m.attr("href");var l=function(q){$(":focus").blur();$(n).add(q).removeClass(d).addClass(k);q.addClass("in").addClass(f);n.addClass("out");var p=function(){n.removeClass(f).add(q).removeClass(d);q.find("a.back").attr("href","#"+n.attr("id")).addClass("reverse").addClass(k);c(e)};if($.support.WebKitAnimationEvent){q.one("webkitAnimationEnd",function(){p()})}else{p()}};if((j).match("^#")){l($(j))}else{var o=generateID(j);$("body").find("#"+o).remove();$("body").append('<div id="'+o+'" class="page"></div>');m.addClass("disabled");$.get(j,function(p){l($("#"+o).append(p));m.attr("href","#"+o).removeClass("disabled")})}return false});$("#settings form input").change(function(){updateStationName($(this))});saveFormValues($("#settings form"));$(".submit").click(function(){var k=$(this);var j=$("#settings form");if(formHasChanged(j)){loadStations(function(){k.addClass("disabled");$("#settings form input[type=text]").each(updateStationName);$.post(j.attr("action"),j.serialize(),function(l){saveFormValues(j);b(function(){if($("#favourites").length>0){k.trigger("transition").removeClass("disabled")}})})})}else{k.trigger("transition").removeClass("disabled")}return false});var c=function(m,j){var l=$(".page."+f);var k=$(".page").first();if(l.length>0){k=l.removeClass(f).first()}if(j){k.fadeIn("slow",function(){$(this).addClass(f)})}else{k.addClass(f)}if(m){m()}};var b=function(j){$.get("/favourites",function(k){$("#favourites").replaceWith(k);if(j){j()}})};var i=function(l,j,n){var m=l.find(".journey").last();var k=l.find("a.loader").attr("href");if(k){k=k.replace(/^(.*)=(.*)$/,"$1="+m.attr("title"));if(j&&j>0){k=k+"&limit="+j}$.get(k,function(p){var r=generateID(k);$("#"+r).remove();$("body").append('<div id="'+r+'"></div>');$("#"+r).append(p);var q=$("#"+r).find(".journey").hide();m.after(q);$("#"+r).remove();var o=l.find("a.loader");o.attr("href",o.attr("href").replace(/^(.*)=(.*)$/,"$1="+l.find(".journey").last().attr("title")));q.slideDown("slow");if(n){n()}})}};$(document).keydown(function(j){if(j.keyCode=="37"){$(".active .left.arrow a").click()}else{if(j.keyCode=="39"){$(".active .right.arrow a").click()}else{if(j.keyCode=="38"){$(".active a.return.reverse").click()}else{if(j.keyCode=="40"){$(".active a.return:not(.reverse)").click()}}}}});var e=function(){$(".page").css("min-height",$(window).height())};$(window).resize(e);var g=function(){$(".journey .eta").each(function(){var n=$(this);var m=n.parents(".journey");var p=new Date();var l=new Date();p.setTime(n.parent().find(".time").first().attr("data-time"));var o=durationInSeconds(l,p);var k=o/60;if(k<=5){n.removeClass("lt_ten").addClass("lt_five")}else{if(k<=10){n.addClass("lt_ten")}}if(o>0||m.hasClass("detail")){n.html(durationInWords(o))}else{n.html("now");m.addClass("expired")}});var j=function(k){if(k){k.animate({opacity:0.5},1000,"linear",function(){$(this).animate({opacity:1},1000,"linear",function(){$(this).animate({opacity:0.5},1000,"linear",function(){$(this).animate({opacity:1},1000,"linear",function(){$(this).animate({opacity:0.5},1000,"linear",function(){$(this).animate({opacity:1},1000,"linear",function(){$(this).slideUp("slow",function(){var l=$(this).parents(".journeys");$(this).remove()})})})})})})})}};$(".journeys").each(function(){var k=$(this);var l=k.find(".journey.expired");var m=h-(k.find(".journey").length-l.length);if(m>0){i(k,m)}j(l)});window.setTimeout(g,millisecondsUntilNextMinute())};var a=$(".ie6 .browser-warning, .ie7 .browser-warning, .ie8 .browser-warning");a.first().slideDown("slow",function(){window.setTimeout(function(){a.first().slideUp("slow",function(){$(".browser-warning").remove()})},10000)});c(e);g()});