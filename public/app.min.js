function plural(a){return a+"s"}function pluralize(b,a){var c=(b==1||b=="1")?a:plural(a);if(b){c=b+" "+c}else{c="0 "+c}return c}function durationInSeconds(b,a){return Math.round((a-b)/1000)}function durationInWords(c){var e=c;var a;var d=e;if(e<0){d=e*-1}if(d==0){a="now"}else{if(d>=1&&d<=3599){a=pluralize(Math.ceil(e/60),"min")}else{if(d>=3600&&d<=86399){var b=Math.floor(e/3600);var h=(e%3600)/60;if(h<30){a=pluralize(b,"hour")}else{a=pluralize(b+0.5,"hour")}}else{if(d>=86400&&d<=2591999){var g=Math.floor(e/86400);var f=(e%86400)/3600;if(f<12){a=pluralize(g,"day")}else{a=pluralize(g+0.5,"day")}}else{if(d<=2592000&&d<=31535999){a=pluralize(Math.ceil(e/2592000),"mth")}else{a=pluralize(Math.ceil(e/31536000),"yr")}}}}}return a}var millisecondsUntilNextMinute=function(){var a=new Date();var b=new Date();b.setMinutes(a.getMinutes()+1);b.setSeconds(0);b.setMilliseconds(0);return b-a};var generateID=function(a){return"id"+a.replace(/[^a-zA-Z0-9]/g,"_")};$(document).ready(function(){$.support.iPhone=((navigator.userAgent.match(/iPhone/i))||(navigator.userAgent.match(/iPod/i)));$.support.Standalone=window.navigator.standalone;$.support.WebKitAnimationEvent=(typeof WebKitTransitionEvent=="object");var h=5;var e="active";var c="fx in out flip slide pop cube swap slideup dissolve fade reverse";var b=function(m,j){var l=$(".page."+e);var k=$(".page").first();if(l.length>0){k=l.removeClass(e).first()}if(j){k.fadeIn("slow",function(){$(this).addClass(e)})}else{k.addClass(e)}if(m){m()}};$("a.loader").live("click",function(){i($(this).parents(".journeys"));return false});var i=function(l,j){var m=l.find(".journey").last();var k=l.find("a.loader").attr("href").replace(/^(.*)=(.*)$/,"$1="+m.attr("title"));if(j&&j>0){k=k+"&limit="+j}$.get(k,function(n){var o=generateID(k);$("#"+o).remove();$(".content").append('<section id="'+o+'"></section>');$("#"+o).append(n);m.after($("#"+o).find(".journey").hide().slideDown("slow",function(){$("#"+o).remove();var p=l.find("a.loader");p.attr("href",p.attr("href").replace(/^(.*)=(.*)$/,"$1="+l.find(".journey").last().attr("title")))}))})};var a=function(j){$.get("/",function(k){$("#favourites").remove();$(".content").append(k);if(j){j()}})};var g=function(l){var j="/settings";var k=generateID(j);$(".content").find("#"+k).remove();$(".content").append('<section id="'+k+'" class="page"></section>');$.get(j,function(m){$("#"+k).append(m);if(l){l()}})};$("a.fx:not(.disabled):not(.submit)").live("click",function(){$(this).trigger("transition");return false});$("a.disabled").live("click",function(){return false});$(":input").live("change",function(){var j=$(this);var l=j.parents(".page").find("a.back");var k=j.parents("form").first();k.data("dirty",true);l.addClass("disabled");k.find("li").each(function(){var m=$(this).find(":selected");var n=m.first().attr("value");if((m.filter("[value='']").length==0)&&(m.filter("[value='"+n+"']").length<2)){l.removeClass("disabled")}})});$("a.fx").live("transition",function(){var m=$(this);var k=m.attr("class");var n=m.parents(".page").last();var j=m.attr("href");var l=function(q){$(":focus").blur();$(n).add(q).removeClass(c).addClass(k);q.addClass("in").addClass(e);n.addClass("out");var p=function(){n.removeClass(e).add(q).removeClass(c);q.find("a.back").attr("href","#"+n.attr("id")).addClass("reverse").addClass(k);b(d)};if($.support.WebKitAnimationEvent){q.one("webkitAnimationEnd",function(){p()})}else{p()}};if((j).match("^#")){l($(j))}else{var o=generateID(j);$(".content").find("#"+o).remove();$(".content").append('<section id="'+o+'" class="page"></section>');m.addClass("disabled");$.get(j,function(p){l($("#"+o).append(p));m.attr("href","#"+o).removeClass("disabled")})}return false});$(".submit").live("click",function(){var k=$(this).addClass("disabled");var j=k.parents(".page").find("form");if(j.data("dirty")){$.post(j.attr("action"),j.serialize(),function(l){a(function(){if($("#favourites").length==0){k.addClass("disabled")}else{k.trigger("transition").removeClass("disabled");j.data("dirty",false)}})})}else{k.trigger("transition").removeClass("disabled")}return false});$(document).keydown(function(j){if(j.keyCode=="37"){$(".active .left.arrow a").click()}else{if(j.keyCode=="39"){$(".active .right.arrow a").click()}else{if(j.keyCode=="38"){$(".active a.return.reverse").click()}else{if(j.keyCode=="40"){$(".active a.return:not(.reverse)").click()}}}}});var d=function(){$(".page").css("min-height",$(window).height())};$(window).resize(d);var f=function(){$(".journey .eta").each(function(){var m=$(this);var l=m.parents(".journey");var o=new Date();var k=new Date();o.setTime(m.parent().find(".time").first().attr("title"));var n=durationInSeconds(k,o);var j=n/60;if(j<=5){m.removeClass("lt_ten").addClass("lt_five")}else{if(j<=10){m.addClass("lt_ten")}}if(n>0||l.hasClass("detail")){m.html(durationInWords(n))}else{m.html("now");l.addClass("expired")}});$(".journeys").each(function(){var j=$(this);var k=j.find(".journey.expired");var l=h-(j.find(".journey").length-k.length);if(l>0){i(j,l)}k.animate({opacity:0.5},1000,"linear",function(){$(this).animate({opacity:1},1000,"linear",function(){$(this).animate({opacity:0.5},1000,"linear",function(){$(this).animate({opacity:1},1000,"linear",function(){$(this).animate({opacity:0.5},1000,"linear",function(){$(this).animate({opacity:1},1000,"linear",function(){$(this).slideUp("slow",function(){var m=$(this).parents(".journeys");$(this).remove()})})})})})})})});window.setTimeout(f,millisecondsUntilNextMinute())};b(d);f();if($.support.iPhone&&!$.support.Standalone){window.setTimeout(function(){$("body > footer").slideToggle("slow");window.setTimeout(function(){$("body > footer").slideToggle("slow")},8000)},1500)}});