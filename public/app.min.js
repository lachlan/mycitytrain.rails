function plural(a){return a+"s"}function pluralize(b,a){var c=(b==1||b=="1")?a:plural(a);if(b){c=b+" "+c}else{c="0 "+c}return c}function durationInSeconds(b,a){return Math.round((a-b)/1000)}function durationInWords(c){var e=c;var a;var d=e;if(e<0){d=e*-1}if(d==0){a="now"}else{if(d>=1&&d<=3599){a=pluralize(Math.ceil(e/60),"min")}else{if(d>=3600&&d<=86399){var b=Math.floor(e/3600);var h=(e%3600)/60;if(h<30){a=pluralize(b,"hour")}else{a=pluralize(b+0.5,"hour")}}else{if(d>=86400&&d<=2591999){var g=Math.floor(e/86400);var f=(e%86400)/3600;if(f<12){a=pluralize(g,"day")}else{a=pluralize(g+0.5,"day")}}else{if(d<=2592000&&d<=31535999){a=pluralize(Math.ceil(e/2592000),"mth")}else{a=pluralize(Math.ceil(e/31536000),"yr")}}}}}return a}var millisecondsUntilNextMinute=function(){var a=new Date();var b=new Date();b.setMinutes(a.getMinutes()+1);b.setSeconds(0);b.setMilliseconds(0);return b-a};var generateID=function(a){return"id"+a.replace(/[^a-zA-Z0-9]/g,"_")};$(document).ready(function(){$.support.WebKitAnimationEvent=(typeof WebKitTransitionEvent=="object");var k=5;var f="active";var c="fx in out flip slide pop cube swap slideup dissolve fade reverse";var g=new Array();var l=function(n,o){if(o){var q=new RegExp("^"+n+"$","i")}else{var q=new RegExp("^"+n,"i")}var p=new Array();for(var m=0;m<g.length;m++){if(g[m].match(q)){p.push(g[m])}}return p};$("input.origin, input.destination").autocomplete({minLength:1,source:function(n,m){i(function(){m(l(n.term))})}});var i=function(m){if(g.length==0){$.getJSON("/stations",function(n){g=n;if(m){m()}})}else{if(m){m()}}};var e=function(){$("a.loader").click(function(){j($(this).parents(".journeys"));return false});$("a.fx:not(.disabled):not(.submit)").click(function(){$(this).trigger("transition");return false});$("a.disabled").click(function(){return false});$("a.fx").bind("transition",function(){var q=$(this);var o=q.attr("class");var r=q.parents(".page").last();var n=q.attr("href");var p=function(u){$(":focus").blur();$(r).add(u).removeClass(c).addClass(o);u.addClass("in").addClass(f);r.addClass("out");var t=function(){r.removeClass(f).add(u).removeClass(c);u.find("a.back").attr("href","#"+r.attr("id")).addClass("reverse").addClass(o);b(d)};if($.support.WebKitAnimationEvent){u.one("webkitAnimationEnd",function(){t()})}else{t()}};if((n).match("^#")){p($(n))}else{var s=generateID(n);$("body").find("#"+s).remove();$("body").append('<div id="'+s+'" class="page"></div>');q.addClass("disabled");$.get(n,function(t){p($("#"+s).append(t));q.attr("href","#"+s).removeClass("disabled");e()})}return false});var m=function(){var o=$(this).attr("value");if(o){var n=l(o,true);if(n.length>0){$(this).attr("value",n[0])}}};$("#settings form input").change(function(){m();$(this).parents("form").data("dirty",true)});$(".submit").click(function(){var o=$(this);var n=$("#settings form");if(n.data("dirty")){i(function(){o.addClass("disabled");$("#settings form input[type=text]").each(m);$.post(n.attr("action"),n.serialize(),function(p){n.data("dirty",false);if($.browser.msie){location.href="/"}else{a(function(){e();if($("#favourites").length>0){o.trigger("transition").removeClass("disabled")}})}})})}else{o.trigger("transition").removeClass("disabled")}return false})};var b=function(p,m){var o=$(".page."+f);var n=$(".page").first();if(o.length>0){n=o.removeClass(f).first()}if(m){n.fadeIn("slow",function(){$(this).addClass(f)})}else{n.addClass(f)}if(p){p()}};var a=function(m){$.get("/",function(n){$("#favourites").remove();$("body").append(n);if(m){m()}})};var j=function(o,m){var p=o.find(".journey").last();var n=o.find("a.loader").attr("href");if(n){n=n.replace(/^(.*)=(.*)$/,"$1="+p.attr("title"));if(m&&m>0){n=n+"&limit="+m}$.get(n,function(q){var r=generateID(n);$("#"+r).remove();$("body").append('<div id="'+r+'"></div>');$("#"+r).append(q);p.after($("#"+r).find(".journey").hide().slideDown("slow",function(){$("#"+r).remove();var s=o.find("a.loader");s.attr("href",s.attr("href").replace(/^(.*)=(.*)$/,"$1="+o.find(".journey").last().attr("title")))}));e()})}};$(document).keydown(function(m){if(m.keyCode=="37"){$(".active .left.arrow a").click()}else{if(m.keyCode=="39"){$(".active .right.arrow a").click()}else{if(m.keyCode=="38"){$(".active a.return.reverse").click()}else{if(m.keyCode=="40"){$(".active a.return:not(.reverse)").click()}}}}});var d=function(){$(".page").css("min-height",$(window).height())};$(window).resize(d);var h=function(){$(".journey .eta").each(function(){var p=$(this);var o=p.parents(".journey");var r=new Date();var n=new Date();r.setTime(p.parent().find("time").first().attr("data-time"));var q=durationInSeconds(n,r);var m=q/60;if(m<=5){p.removeClass("lt_ten").addClass("lt_five")}else{if(m<=10){p.addClass("lt_ten")}}if(q>0||o.hasClass("detail")){p.html(durationInWords(q))}else{p.html("now");o.addClass("expired")}});$(".journeys").each(function(){var m=$(this);var n=m.find(".journey.expired");var o=k-(m.find(".journey").length-n.length);if(o>0){j(m,o)}n.animate({opacity:0.5},1000,"linear",function(){$(this).animate({opacity:1},1000,"linear",function(){$(this).animate({opacity:0.5},1000,"linear",function(){$(this).animate({opacity:1},1000,"linear",function(){$(this).animate({opacity:0.5},1000,"linear",function(){$(this).animate({opacity:1},1000,"linear",function(){$(this).slideUp("slow",function(){var p=$(this).parents(".journeys");$(this).remove()})})})})})})})});window.setTimeout(h,millisecondsUntilNextMinute())};b(d);h();e()});