function plural(a){return a+"s"}function pluralize(b,a){var c=(b==1||b=="1")?a:plural(a);if(b){c=b+" "+c}else{c="0 "+c}return c}function durationInSeconds(b,a){return Math.round((a-b)/1000)}function durationInWords(c){var e=c;var a;var d=e;if(e<0){d=e*-1}if(d==0){a="now"}else{if(d>=1&&d<=3599){a=pluralize(Math.ceil(e/60),"min")}else{if(d>=3600&&d<=86399){var b=Math.floor(e/3600);var h=(e%3600)/60;if(h<30){a=pluralize(b,"hour")}else{a=pluralize(b+0.5,"hour")}}else{if(d>=86400&&d<=2591999){var g=Math.floor(e/86400);var f=(e%86400)/3600;if(f<12){a=pluralize(g,"day")}else{a=pluralize(g+0.5,"day")}}else{if(d<=2592000&&d<=31535999){a=pluralize(Math.ceil(e/2592000),"mth")}else{a=pluralize(Math.ceil(e/31536000),"yr")}}}}}return a}var millisecondsUntilNextMinute=function(){var a=new Date();var b=new Date();b.setMinutes(a.getMinutes()+1);b.setSeconds(0);b.setMilliseconds(0);return b-a};var generateID=function(a){return"id"+a.replace(/[^a-zA-Z0-9]/g,"_")};$(document).ready(function(){$.support.iPhone=((navigator.userAgent.match(/iPhone/i))||(navigator.userAgent.match(/iPod/i)));$.support.Standalone=window.navigator.standalone;$.support.WebKitAnimationEvent=(typeof WebKitTransitionEvent=="object");var d=5;var e="active";var c="fx in out flip slide pop cube swap slideup dissolve fade reverse";var h=function(l,i){var k=$(".page."+e);var j=$(".page").first();if(k.length>0){j=k.removeClass(e).first()}if(i){j.fadeIn("slow",function(){$(this).addClass(e)})}else{j.addClass(e)}if(l){l()}};$("a.loader").click(function(){b($(this).parents(".journeys"));return false});var b=function(k,i){var l=k.find(".journey").last();var j=k.find("a.loader").attr("href").replace(/^(.*)=(.*)$/,"$1="+l.attr("title"));if(i&&i>0){j=j+"&limit="+i}$.get(j,function(m){var n=generateID(j);$("#"+n).remove();$(".content").append('<div id="'+n+'"></div>');$("#"+n).append(m);l.after($("#"+n).find(".journey").hide().slideDown("slow",function(){$("#"+n).remove();var o=k.find("a.loader");o.attr("href",o.attr("href").replace(/^(.*)=(.*)$/,"$1="+k.find(".journey").last().attr("title")))}))})};var a=function(i){$.get("/",function(j){$("#favourites").remove();$(".content").append(j);if(i){i()}})};$("a.fx:not(.disabled):not(.submit)").live("click",function(){$(this).trigger("transition");return false});$("a.disabled").live("click",function(){return false});$(":input").change(function(){var i=$(this);var k=i.parents(".page").find("a.back");var j=i.parents("form").first();j.data("dirty",true);k.addClass("disabled");j.find("li").each(function(){var l=$(this).find(":selected");var m=l.first().attr("value");if((l.filter("[value='']").length==0)&&(l.filter("[value='"+m+"']").length<2)){k.removeClass("disabled")}})});$("a.fx").live("transition",function(){var l=$(this);var j=l.attr("class");var m=l.parents(".page").last();var i=l.attr("href");var k=function(p){$(":focus").blur();$(m).add(p).removeClass(c).addClass(j);p.addClass("in").addClass(e);m.addClass("out");var o=function(){m.removeClass(e).add(p).removeClass(c);p.find("a.back").attr("href","#"+m.attr("id")).addClass("reverse").addClass(j);h(g)};if($.support.WebKitAnimationEvent){p.one("webkitAnimationEnd",function(){o()})}else{o()}};if((i).match("^#")){k($(i))}else{var n=generateID(i);$(".content").find("#"+n).remove();$(".content").append('<div id="'+n+'" class="page"></div>');l.addClass("disabled");$.get(i,function(o){k($("#"+n).append(o));l.attr("href","#"+n).removeClass("disabled")})}return false});$(".submit").click(function(){var j=$(this).addClass("disabled");var i=j.parents(".page").find("form");if(i.data("dirty")){$.post(i.attr("action"),i.serialize(),function(k){a(function(){if($("#favourites").length==0){j.addClass("disabled")}else{j.trigger("transition").removeClass("disabled");i.data("dirty",false)}})})}else{j.trigger("transition").removeClass("disabled")}return false});$(document).keydown(function(i){if(i.keyCode=="37"){$(".active .left.arrow a").click()}else{if(i.keyCode=="39"){$(".active .right.arrow a").click()}else{if(i.keyCode=="38"){$(".active a.return.reverse").click()}else{if(i.keyCode=="40"){$(".active a.return:not(.reverse)").click()}}}}});var g=function(){$(".page").css("min-height",$(window).height())};$(window).resize(g);var f=function(){$(".journey .eta").each(function(){var l=$(this);var k=l.parents(".journey");var n=new Date();var j=new Date();n.setTime(l.parent().find(".time").first().attr("data-time"));var m=durationInSeconds(j,n);var i=m/60;if(i<=5){l.removeClass("lt_ten").addClass("lt_five")}else{if(i<=10){l.addClass("lt_ten")}}if(m>0||k.hasClass("detail")){l.html(durationInWords(m))}else{l.html("now");k.addClass("expired")}});$(".journeys").each(function(){var i=$(this);var j=i.find(".journey.expired");var k=d-(i.find(".journey").length-j.length);if(k>0){b(i,k)}j.animate({opacity:0.5},1000,"linear",function(){$(this).animate({opacity:1},1000,"linear",function(){$(this).animate({opacity:0.5},1000,"linear",function(){$(this).animate({opacity:1},1000,"linear",function(){$(this).animate({opacity:0.5},1000,"linear",function(){$(this).animate({opacity:1},1000,"linear",function(){$(this).slideUp("slow",function(){var l=$(this).parents(".journeys");$(this).remove()})})})})})})})});window.setTimeout(f,millisecondsUntilNextMinute())};h(g);f();if($.support.iPhone&&!$.support.Standalone){window.setTimeout(function(){$("body > .footer").slideToggle("slow");window.setTimeout(function(){$("body > .footer").slideToggle("slow")},8000)},1500)}});