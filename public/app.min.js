function plural(a){return a+"s"}function pluralize(b,a){var c=(b==1||b=="1")?a:plural(a);if(b){c=b+" "+c}else{c="0 "+c}return c}function durationInSeconds(b,a){return Math.round((a-b)/1000)}function durationInWords(c){var e=c;var a;var d=e;if(e<0){d=e*-1}if(d==0){a="now"}else{if(d>=1&&d<=3599){a=pluralize(Math.ceil(e/60),"min")}else{if(d>=3600&&d<=86399){var b=Math.floor(e/3600);var h=(e%3600)/60;if(h<30){a=pluralize(b,"hour")}else{a=pluralize(b+0.5,"hour")}}else{if(d>=86400&&d<=2591999){var g=Math.floor(e/86400);var f=(e%86400)/3600;if(f<12){a=pluralize(g,"day")}else{a=pluralize(g+0.5,"day")}}else{if(d<=2592000&&d<=31535999){a=pluralize(Math.ceil(e/2592000),"mth")}else{a=pluralize(Math.ceil(e/31536000),"yr")}}}}}return a}var millisecondsUntilNextMinute=function(){var a=new Date();var b=new Date();b.setMinutes(a.getMinutes()+1);b.setSeconds(0);b.setMilliseconds(0);return b-a};var generateID=function(a){return"id"+a.replace(/[^a-zA-Z0-9]/g,"_")};$(document).ready(function(){$.support.WebKitAnimationEvent=(typeof WebKitTransitionEvent=="object");var j=5;var g="active";var d="fx in out flip slide pop cube swap slideup dissolve fade reverse";var a=new Array();var k=function(m){var o=new RegExp("^"+m,"i");var n=new Array();for(var l=0;l<a.length;l++){if(a[l].match(o)){n.push(a[l])}}return n};$("input.origin, input.destination").autocomplete({minLength:1,source:function(m,l){if(a.length>0){l(k(m.term))}else{$.getJSON("/stations",function(n){a=n;l(k(m.term))})}}});var f=function(){$("a.loader").click(function(){i($(this).parents(".journeys"));return false});$("a.fx:not(.disabled):not(.submit)").click(function(){$(this).trigger("transition");return false});$("a.disabled").click(function(){return false});$(":input").change(function(){var l=$(this);var n=l.parents(".page").find("a.back");var m=l.parents("form").first();m.data("dirty",true);n.addClass("disabled");m.find("li").each(function(){var o=$(this).find(":selected");var p=o.first().attr("value");if((o.filter("[value='']").length==0)&&(o.filter("[value='"+p+"']").length<2)){n.removeClass("disabled")}})});$("a.fx").bind("transition",function(){var o=$(this);var m=o.attr("class");var p=o.parents(".page").last();var l=o.attr("href");var n=function(s){$(":focus").blur();$(p).add(s).removeClass(d).addClass(m);s.addClass("in").addClass(g);p.addClass("out");var r=function(){p.removeClass(g).add(s).removeClass(d);s.find("a.back").attr("href","#"+p.attr("id")).addClass("reverse").addClass(m);c(e)};if($.support.WebKitAnimationEvent){s.one("webkitAnimationEnd",function(){r()})}else{r()}};if((l).match("^#")){n($(l))}else{var q=generateID(l);$("body").find("#"+q).remove();$("body").append('<div id="'+q+'" class="page"></div>');o.addClass("disabled");$.get(l,function(r){n($("#"+q).append(r));o.attr("href","#"+q).removeClass("disabled");f()})}return false});$(".submit").click(function(){var m=$(this).addClass("disabled");var l=m.parents(".page").find("form");if(l.data("dirty")){$.post(l.attr("action"),l.serialize(),function(n){if($.browser.msie){location.href="/"}else{b(function(){f();if($("#favourites").length==0){m.addClass("disabled")}else{m.trigger("transition").removeClass("disabled");l.data("dirty",false)}})}})}else{m.trigger("transition").removeClass("disabled")}return false})};var c=function(o,l){var n=$(".page."+g);var m=$(".page").first();if(n.length>0){m=n.removeClass(g).first()}if(l){m.fadeIn("slow",function(){$(this).addClass(g)})}else{m.addClass(g)}if(o){o()}};var b=function(l){$.get("/",function(m){$("#favourites").remove();$("body").append(m);if(l){l()}})};var i=function(n,l){var o=n.find(".journey").last();var m=n.find("a.loader").attr("href");if(m){m=m.replace(/^(.*)=(.*)$/,"$1="+o.attr("title"));if(l&&l>0){m=m+"&limit="+l}$.get(m,function(p){var q=generateID(m);$("#"+q).remove();$("body").append('<div id="'+q+'"></div>');$("#"+q).append(p);o.after($("#"+q).find(".journey").hide().slideDown("slow",function(){$("#"+q).remove();var r=n.find("a.loader");r.attr("href",r.attr("href").replace(/^(.*)=(.*)$/,"$1="+n.find(".journey").last().attr("title")))}));f()})}};$(document).keydown(function(l){if(l.keyCode=="37"){$(".active .left.arrow a").click()}else{if(l.keyCode=="39"){$(".active .right.arrow a").click()}else{if(l.keyCode=="38"){$(".active a.return.reverse").click()}else{if(l.keyCode=="40"){$(".active a.return:not(.reverse)").click()}}}}});var e=function(){$(".page").css("min-height",$(window).height())};$(window).resize(e);var h=function(){$(".journey .eta").each(function(){var o=$(this);var n=o.parents(".journey");var q=new Date();var m=new Date();q.setTime(o.parent().find("time").first().attr("data-time"));var p=durationInSeconds(m,q);var l=p/60;if(l<=5){o.removeClass("lt_ten").addClass("lt_five")}else{if(l<=10){o.addClass("lt_ten")}}if(p>0||n.hasClass("detail")){o.html(durationInWords(p))}else{o.html("now");n.addClass("expired")}});$(".journeys").each(function(){var l=$(this);var m=l.find(".journey.expired");var n=j-(l.find(".journey").length-m.length);if(n>0){i(l,n)}m.animate({opacity:0.5},1000,"linear",function(){$(this).animate({opacity:1},1000,"linear",function(){$(this).animate({opacity:0.5},1000,"linear",function(){$(this).animate({opacity:1},1000,"linear",function(){$(this).animate({opacity:0.5},1000,"linear",function(){$(this).animate({opacity:1},1000,"linear",function(){$(this).slideUp("slow",function(){var o=$(this).parents(".journeys");$(this).remove()})})})})})})})});window.setTimeout(h,millisecondsUntilNextMinute())};c(e);h();f()});